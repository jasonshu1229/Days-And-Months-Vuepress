---
title: 面试题汇总之浏览器原理篇
date: 2022-09-14 23:13:52
permalink: /pages/5fa8ac/
tags: 
  - 
---

![](https://s2.loli.net/2023/03/26/KLxAPfU6qrpQ2je.png)

### 一、浏览器安全

### 1. 什么是 XSS 攻击？
   
**（1）概念**

XSS 攻击指的是`跨站脚本攻击`，是一种代码注入攻击。攻击者通过在网站注入恶意脚本，使之在用户的浏览器上运行，从而盗取用户的信息比如 cookie 等。

XSS 的本质是因为网站没有对恶意代码进行过滤，与正常的代码混合在一起了，浏览器没有办法分辨哪些脚本是可信的，从而导致了恶意代码的执行。

攻击者可以通过这种攻击方式可以进行以下操作：

- 获取页面的数据，如DOM、cookie、localStorage；
- DOS攻击，发送合理请求，占用服务器资源，从而使用户无法访问服务器；
- 破坏页面结构；
- 流量劫持（将链接指向某网站）；

**（2）攻击类型**

XSS 可以分为存储型、反射型和 DOM 型：

- 存储型指的是恶意脚本会存储在目标服务器上，当浏览器请求数据时，脚本从服务器传回并执行。
- 反射型指的是攻击者诱导用户访问一个带有恶意代码的 URL 后，服务器端接收数据后处理，然后把带有恶意代码的数据发送到浏览器端，浏览器端解析这段带有 XSS 代码的数据后当做脚本执行，最终完成 XSS 攻击。 
- DOM 型指的通过修改页面的 DOM 节点形成的 XSS。

### 2. 如何防御XSS？

- 从浏览器的执行来进行预防：
  - 一种是使用纯前端的方式，不用服务器段拼接后返回（不适用服务端渲染）。
  - 另一种是对需要插入到 HTML 中的代码做好充分的转义。对于 DOM 型的攻击，主要是前端交办的不可靠造成的，对于`数据获取渲染`和`字符串拼接`的时候应该对可能出现的恶意代码情况进行判断。
- 使用 CSP，CSP 的本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行，从而防止恶意代码的注入攻击。
- 对一些敏感信息进行保护，比如 cookie 使用 http-only，使得脚本无法获取。也可以使用验证码，避免脚本伪装成用户执行一些操作。

> 1. CSP 指的是内容安全策略，它的本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行。我们只需要配置规则，如何拦截由浏览器自己来实现。
> 
> 2. 通常有两种方式来开启 CSP，一种是设置 HTTP 首部中的 Content-Security-Policy，一种是设置 meta 标签的方式

### 3. 什么是 CSRF 攻击？

**（1）概念**

CSRF 攻击指的是`跨站请求伪造攻击`，攻击者诱导用户进入一个第三方网站，然后第三方网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。

CSRF 攻击的本质`是利用 cookie 会在同源请求中携带发送给服务器的特点，以此来实现用户的冒充`。

**（2）可能造成的危害**

利用用户的登录状态权限发表一些不当的言论，或者篡改信息等等

**（3）防御手段**

1. 验证码：强制用户必须与应用进行交互，才能完成最终请求。
2. 尽量使用 post ，限制 get 的使用。
3. `token`的验证 CSRF 防御机制是公认的最合适的方案。

**使用token的原理**：

第一步：后端随机产生一个 token，把这个token 保存到 session 状态中；同时后端把这个token 交给前端页面；

第二步：前端页面提交请求时，把 token 加入到请求数据或者头信息中，一起传给后端；

第三步：后端验证前端传来的 token 与 session 是否一致，一致则合法，否则是非法请求。

### 二、浏览器渲染原理

### 1. 从输入 URL 到页面展示都经历了哪些阶段？

我们可以概括为三个阶段，分别是**用户输入阶段，URL请求阶段、准备渲染进程阶段**。

#### 阶段一：用户输入阶段

1. 用户输入`URL`，浏览器会根据用户输入的信息判断是**搜索内容**还是**网址**
   - 如果是**搜索内容**，就将搜索内容+默认搜素引擎合成新的`URL`；
   - 如果用户输入的内容是**网址**，浏览器会根据`URL`协议，在这段内容上加上协议合成合法的`URL`。

#### 阶段二：URL请求阶段

1. **浏览器进程**通过进程间的通信把`URL`请求发送给**网络进程**。
2. **网络进程**接收到`URL`请求后检查**本地缓存**是否缓存了该请求资源
   - 如果有缓存，将该资源返回给**浏览器进程**；
     - 此时的缓存应该是**强缓存**，通过`Expires`或`Cache-Control: max`判断缓存是否过期，未过期，直接使用该资源，Expires 和 max-age，如果两者同时存在，则被 Cache-Control 的 max-age 覆盖
     - 如果是**协商缓存**，请求头部带上相关信息如`if-none-match(Etga)`与`if-modified-since(last-modified)`，验证缓存是否有效，若有效则返回状态`304`，若无效则重新返回资源，状态码为`200`
   - 如果没有，**网络进程**向`web服务器`发起`http`请求，请求过程如下：
      - 进行`DNS`解析`URL`，获取对应的服务器`ip地址`；
      - 根据`ip地址`和服务器建立`TCP连接`（三次握手）；
      - HTTP 发起请求；
      - 服务器处理请求，服务器响应后，会把响应头和相应信息传给**网络进程**，并解析响应内容；
      - 浏览器接收 HTTP 响应；
3. **网络进程**解析响应流程；
   - 检查状态码，如果是301/302，则需要重定向，从 `Location` 自动中读取地址，重新进行第3步；
   - 200 状态码响应处理，检查响应类型 `Content-Type`，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续的渲染；
   如果是html则通知浏览器进程准备渲染进程准备进行渲染。

#### 阶段三：渲染进程开始渲染页面的工作

5. 对文档进行页面解析和子资源加载
   - **渲染进程**将 HTML 解析，生成 DOM 树结构；
   - 渲染引擎将 CSS 按照 CSS 解析器的规则转换成 CSSOM 树，两个树结合形成 render tree（不包含 HTML 具体元素以及具体位置）；
   - 根据渲染树计算每一个节点的信息（Layout布局）；
   - 根据计算好的信息绘制页面；

   如果遇到 script 标签，则判断是否含有 defer 或者 async 属性，如果有，异步去下载该资源；
   如果没有设置，暂定 DOM 树的解析，去加载 script 的资源，然后执行该 js 代码（**script 标签加载和执行会阻塞页面的渲染**）

6. 关闭`TCP连接`（四次挥手）

### 三、浏览器安全
